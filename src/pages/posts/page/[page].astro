---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PostCard from '../../../components/PostCard.astro';
import { getCollection } from 'astro:content';
import { filterDrafts, paginate, sortPosts } from '../../../lib/utils';

const pageSize = 5;

export async function getStaticPaths() {
  const pages = paginate(sortPosts(filterDrafts(await getCollection('blog'))), pageSize);
  return pages.slice(1).map((items, index) => ({
    params: { page: String(index + 2) },
    props: {
      posts: items,
      totalPages: pages.length,
      currentPage: index + 2,
    },
  }));
}

interface Props {
  posts: Awaited<ReturnType<typeof getCollection<'blog'>>>;
  totalPages: number;
  currentPage: number;
}

const { posts, totalPages, currentPage } = Astro.props as Props;
---
<BaseLayout title={`第 ${currentPage} 页`} description="分页文章列表">
  <h1 class="text-3xl font-bold text-gray-900">全部文章</h1>
  <p class="mt-2 text-gray-700">第 {currentPage} 页 / 共 {totalPages} 页</p>

  <div class="mt-6 space-y-6">
    {posts.map((post) => (
      <PostCard post={post} />
    ))}
  </div>

  <nav class="mt-8 flex items-center justify-between" aria-label="分页导航">
    <a
      class={`text-sm font-semibold ${currentPage === 1 ? 'text-muted' : 'text-primary underline'}`}
      href={currentPage <= 2 ? '/posts/' : `/posts/page/${currentPage - 1}/`}
    >
      上一页
    </a>
    <a
      class={`text-sm font-semibold ${currentPage >= totalPages ? 'text-muted' : 'text-primary underline'}`}
      href={`/posts/page/${Math.min(totalPages, currentPage + 1)}/`}
    >
      下一页
    </a>
  </nav>
</BaseLayout>
